

      template <int N>
      void validate(bool hasGhosts, nGroup)
      {
         storage().isValid(atomStorage(), domain().communicator(), hasGhosts);

         // Check that total number of groups == nGroup
         storage().unsetNTotal();
         storage().computeNTotal(domain().communicator());
         if (domain().isMaster()) {
            int nTotal = storage().nTotal();
            if (nTotal != nAtom) {
               UTIL_THROW("nTotal != nAtom after distribution");
            }
         }
      }
