-------------------------------------------------------------------------------
Existing classes in mcMd/potentials/coulomb:

   CoulombPotential : ParamComposite
   -> Base class for coulomb potentials (i.e., k-space potentials)

   Proposal: Change name of CoulombPotential to KSpacePotential to
   indicate usability for, e.g., dipolar forces, long range 1/r^6 etc.

   EwaldCoulombPotential : CoulombPotential, CoulombSystemMixIn
   -> Implementation of CoulombPotential
  
   EwaldCoulombPair 
   -> Pair interaction for short range Ewald Coulomb interaction
  
   CoulombPotential has an associated EwaldCoulombPair, which is set 
   by the setPairInteraction() method. CoulombPotential is also a 
   friend of EwaldCoulombPair, and so can modify its parameters. 

   MdCoulombPairPotential<PairInteraction, CoulombInteraction>

---------------------------------------------------------------------
Proposed design:

   Principles:

   1) Both KSpacePotential and PairPotential classes have a 
   hierarchy with an abstract base class that defines an
   interface and implementation classes or template that 
   define nuts and bolts of the implementation.

   2) Short-range non-Coulomb and short range part of Coulomb
   forces are computed in the same loop by template instantiation
   MdCoulombPairPotential<PairInteraction, CoulombPairInteraction>

   3) Values for physical and algorithm parameters associated
   with Coulomb interactions are input in the KSpacePotential 
   part of the parameter file, but are shared as needed with 
   the PairPotential class (mechanism discussed below).

   4) KSpacePotential part of the parameter file should appear
   in the parameter file, if at all, as the first potential
   energy block, before the PairPotential block. 

   4) Data is shared between the pair and long-range implementation
   classes by an instance of a specialized structure called something
   like EwaldSharedData. EwaldSharedData provides places to store:

      - Physical Coulomb parameters (e.g., dielectric constant)
      - Shared algorithmic Coulomb parameters (e.g., alpha and r cutoff)
      - Accumulated values of r-space contributions to Coulomb 
        energy and stress


   5) EwaldCoulombPotential is derived from EwaldSharedData, as a
      private base class.

      Physical and algorithmic input parameter members of EwaldShared
      Data are declared protected, and energy and stress accumulators
      are declared public. 

      EwaldCoulombPotential will have a public member sharedData()
      that returns the EwaldSharedData as a non-const reference.

   6) MdPairPotential<Pair, RSpace> has a private pointer to the 
      EwaldSharedData base class of the EwaldPotential. The pointer 
      is passed in the factory that creates the pair potential object 
      using a constructor that takes a references to the KSpacePotential
      as an argument. This constructor will have to use a dynamic cast
      of KSpacePotential to EwaldColumbPotential to get a pointer to a
      EwaldCoulombPotential, and then access the sharedData() member to
      get the address of the EwaldSharedData object.


   7) Values of the energy and stress arising from the non-coulombic
      pair potential will be accumulated separately from those arising
      from the r-space part of the coulomb / kspace potential. The
      short range coulomb parts will be accumulated in values that
      are members of EwaldSharedData, and so will be accessible in
      the EwaldCoulombPotential.  

    8) The KSpace potential will provide accessors to allow access
       to either KSpace and RSpace components of energy and stress
       separately, or just the total, to allow public access to
       some results broken down in a way needed to test algorihms.

    9) The energy and stress accessors of the PairPotential class
       will only report the non-coulombic (e.g., Lennard-Jones)
       contributions, leaving it to the KSpace potential to return
       values of the short-range Coulombic contributions.

-------------------------------------------------------------------
       Class sketches:

   /// Abstract base class for potentials with K-space part
   /// Interface class - no data
   KSpacePotential : public ParamComposite
   {
   public:
       virtual void addForce() = 0;
       virtual void computeEnergy() = 0;
       virtual void computeEnergy() = 0;
       -> public pure virtual accessors kspaceEnergy() and kspaceStress()
       -> public upre virtual accessors rspaceEnergy() and rspaceStress()

   /// Class template for sharing data between pair and kspace potentials
   EwaldSharedData {

       protected:

          // Accumulators for short-range parts of energy and stress
          double rSpaceEnergy_;
          double rSpaceStress_;

          // Algorithmic parameters
          double alpha_;

          // Physical Parameters
          double epsilon_;

   }

   /// Ewald Coulomb pair interaction class (similar to LJPair)
   class EwaldCoulombPairInteraction : public ParamComposite

   /// Pair potential class template
   template <class PairInteraction, CoulombInteraction>
   class MdCoulombPairPotentialImpl<PairInteraction, CoulombInteraction> 
    : public EwaldSharedData
   {

       // Force evaluation, which adds both types of pair force.
       virtual void addForces();

       /** 
       * Thermo computes, which increment different accumulator variables.
       * Conventional nonbonded pair energy and stress are added to member
       * variables of this class.  Ewald RSpace energy and stress are 
       * added corresponding protected data members of the base class
       * RSpacePotentialData<CoulombInteraction>.
       */
       virtual void computeEnergy();
       virtual void computeStress();

       // Accessors for nonbonded non-Ewald coulomb energy and stress.
       double energy();
       double pressure();
       Tensor& stress();
   }

   /**
   * Ewald Coulomb potential concrete class
   */
   EwaldCoulombPotential : public KSpacePotential
   {
   public:

       // Constructor
       EwaldCoulombPotential(MdPairPotential& )
       {
          // cast to RSpacePotentialData<EwaldCoulombPairInteraction>* pointer.
          // Retain address in private pointer variable.
       }

       /// Add K-Space forces
       void addForces();

       /// Compute K-Space forces
       void computeEnergy();
       void computeStress();

       // Return total Coulomb energy and stress
       double energy();
       void stress(double& pressure);
       void stress(tensor& stress);
  
       // Return K-space contributions
       double kspaceEnergy();
       void stress(double& pressure);
       void stress(Tensor& stress);

       // Return R-space contributions
       double rspaceEnergy();
       void rspaceStress(double& pressure);
       void rspaceStress(Tensor& stress);

    private:

       RSpacePotentialData<EwaldCoulombPairInteraction>* rSpaceDataPtr_;

    }
